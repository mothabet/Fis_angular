<app-loader *ngIf="showLoader"></app-loader>

<div class="main-content p-4 main card reports-content" style="flex: 1;">
    <!-- header -->
    <div class="header d-flex flex-wrap justify-content-between align-items-center report-main-header">
        <h4 class="title">
            التقارير
        </h4>
        <div class="user d-flex justify-content-between align-items-center">
            <div class="dropdown">
                <button type="button" class="btn lang" id="dropdownlang" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <span class="current-lang">عربى</span>
                    <i class="fa-solid fa-chevron-down"></i>

                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownlang">
                    <li><a class="dropdown-item second-lang" href="#">En</a></li>
                </ul>
            </div>
            <i class="fa-solid fa-bell"></i>
            <div class="user-img">
                <img src="../../../../assets//images/avatar.PNG" class="img-fluid">
            </div>
        </div>
    </div>
    <!-- end-header -->
    <div class="header d-flex  justify-content-between align-items-center">
        <h4 class="">
            قائمة التقارير
        </h4>
        <div class="btns d-flex">

            <div class="d-flex flex-grow-1 gap-1 btns-group">

                <button (click)="onTableSelect()" type="button" class="btn btn-add add-report" data-bs-toggle="modal"
                    data-bs-target="#addReportDetails">
                    <i class="fa-solid fa-plus mx-1"></i>
                    إنشاء تفاصيل التقرير
                </button>
                <!-- <button style="background-color: #133C8B;color: white;" type="button" class="btn btn-download"
                    (click)="printExcel()">
                    <img src="../../../../assets/images/list-box-outline.png" alt="" />
                    استخراج تقرير
                </button> -->
            </div>
        </div>
    </div>
    <!-- start content -->
    <div class="content companies report-table" style="margin-bottom: 15px;max-width: 74rem;"
        *ngFor="let report of reports">
        <div class="header d-flex justify-content-between align-items-center" style="width: 100%;">
            <div class="mb-2 d-flex flex-column justify-content-center align-items-center text-center"
                style="width: 90%;">
                <!-- <div class="mb-2">سلطنة عمان / Sultanate of OMAN</div>
                <div class="mb-2">National Center for Statistics & Information / المركز الوطني للإحصاء و المعلومات -->
                <!-- </div> -->
                <div class="mb-2">{{report.part}}</div>
                <ng-container *ngIf="report.reportType == 'FormContent' || report.reportType == 'TablesReport'">
                    <div class="mb-2" *ngFor="let detail of report.reportDetails">
                        <ng-container *ngIf="detail.EnTableName != 'Years'">
                            {{ detail.ArTableName }} / (
                            <span *ngFor="let field of detail.Fields; let i = index">
                                {{ field.name }}<span *ngIf="i < detail.Fields.length - 1"> , </span>
                            </span>
                            )
                        </ng-container>
                        <ng-container *ngIf="detail.EnTableName == 'Years' && detail.Fields.length > 1">
                            السنه / (من {{detail.Fields[0].name}} إلى {{detail.Fields[(detail.Fields.length -
                            1)].name}})
                        </ng-container>
                        <ng-container *ngIf="detail.EnTableName == 'Years' && detail.Fields.length == 1">
                            السنه / ({{detail.Fields[0].name}})
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngIf="report.reportType !== 'FormContent' && report.reportType !== 'TablesReport'">
                    <div *ngIf="report.reportDetails.length > 0">
                        <span>تقرير عن ({{ report.reportDetails[0].ArTableName }})</span>
                        <div class="mb-2" *ngIf="report.reportDetails.length > 1">
                            بحث ب (<span>{{ getArTableNames(report) }}</span>)
                        </div>
                        <div class="mb-2" *ngIf="getReportYear(report)">
                            السنة (<span>{{ getReportYear(report) }}</span>)
                        </div>
                    </div>
                </ng-container>


                <!-- <div class="mb-2" *ngIf="report.fields.length> 0 && report.seconedTable != 'Years' && report.reportType == 'FormContent'">
                    ({{(report.fields[0][3]).value }})
                </div>
                <div class="mb-2" *ngIf="report.fields.length >0 && report.reportType != 'FormContent'">جدول ({{
                    (report.fields[0][1]).value }})</div>
                <div class="mb-2" *ngIf="report.fields.length >0">السنة ({{ (report.fields[0][0]).value }})</div>
                <div class="mb-2" *ngIf="report.seconedTable == 'Years' && report.reportType == 'FormContent'">
                    بحث بالسنة
                </div>

                <div class="mb-2" *ngIf="report.seconedTable == 'ActivitiesRep' && report.reportType != 'FormContent'">
                    الانشطة /
                    <ng-container *ngFor="let field of getUniqueActivities(report.fields); let isLast = last">
                        {{ field.value }}<span *ngIf="!isLast"> - </span>
                    </ng-container>
                </div>

                <div class="mb-2" *ngIf="report.seconedTable == 'ActivitiesRep' && report.reportType == 'FormContent'">
                    بحث بالانشطة
                </div>

                <div class="mb-2" *ngIf="report.seconedTable == 'CompaniesRep' && report.reportType != 'FormContent'">
                    الشركات /
                    <ng-container *ngFor="let field of getUniqueCompanies(report.fields); let isLast = last">
                        {{ field.value }}<span *ngIf="!isLast"> - </span>
                    </ng-container>
                </div>

                <div class="mb-2" *ngIf="report.seconedTable == 'CompaniesRep' && report.reportType == 'FormContent'">
                    بحث بالشركات
                </div>

                <div class="mb-2" *ngIf="report.seconedTable == 'SectorsRep' && report.reportType != 'FormContent'">
                    القطاعات /
                    <ng-container *ngFor="let field of getUniqueSectors(report.fields); let isLast = last">
                        {{ field.value }}<span *ngIf="!isLast"> - </span>
                    </ng-container>
                </div>

                <div class="mb-2" *ngIf="report.seconedTable == 'SectorsRep' && report.reportType == 'FormContent'">
                    بحث بالقطاعات
                </div> -->
            </div>

            <div class="btns d-flex">
                <div class="d-flex flex-grow-1 gap-2 btns-group ">
                    <button type="button" class="btn btn-send" (click)="DeleteReportContent(report.id)">
                        <i class="fa-solid fa-trash"></i>
                        حذف
                    </button>
                </div>
            </div>
        </div>
        <div>
            <div class="table-responsive company-table" style="max-height: 400px; overflow-y: auto;">
                <table class="table table-borderless scrollable-table"
                    *ngIf="report.reportType != 'TablesReport' && report.reportType != 'FormContent'">
                    <thead>
                        <tr class="t-header">
                            <th style="text-align: center;" scope="col" *ngIf="report.fields.length > 0">#</th>
                            <ng-container *ngFor="let field of report.fields[0]">
                                <th style="text-align: center;min-width: 140px" scope="col">
                                    {{ field.key }}
                                </th>
                            </ng-container>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let row of report.fields; let i = index">
                            <td style="text-align: center;" scope="col">{{i + 1}}</td>
                            <ng-container *ngFor="let field of row">
                                <td style="text-align: center;" scope="col">{{field.value}}</td>
                            </ng-container>
                        </tr>
                    </tbody>
                </table>
                <app-table-with-trans-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][9]?.value == 1 || report.fields[0][10]?.value == 1) && (report.fields[0][11]?.value == 'withTrans' || report.fields[0][10]?.value == 'withTrans')"></app-table-with-trans-rep>
                <app-quarter-table-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][10]?.value == 0 || report.fields[0][11]?.value == 0) && (report.fields[0][12]?.value == 'quarter' || report.fields[0][11]?.value == 'quarter')"></app-quarter-table-rep>
                <app-table-without-trans-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][8]?.value == 2 || report.fields[0][9]?.value == 2) && (report.fields[0][10]?.value == 'withoutTrans' || report.fields[0][9]?.value == 'withoutTrans')"></app-table-without-trans-rep>
                <app-one-year-with-parts-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][7]?.value == 3 || report.fields[0][8]?.value == 3) && (report.fields[0][9]?.value == 'yearWithParts'  || report.fields[0][8]?.value == 'yearWithParts')"></app-one-year-with-parts-rep>
                <app-two-years-with-parts-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][10]?.value == 4 || report.fields[0][11]?.value == 4) && (report.fields[0][12]?.value == 'twoYearsWithParts' || report.fields[0][11]?.value == 'twoYearsWithParts')"></app-two-years-with-parts-rep>
                <app-table-with-periods-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && (report.fields[0][6]?.value == 5 || report.fields[0][7]?.value == 5) && (report.fields[0][8]?.value == 'period' || report.fields[0][7]?.value == 'period')"></app-table-with-periods-rep>
                <app-percentage-without-trans-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][9]?.value == 6 || report.fields[0][10]?.value == 6) && (report.fields[0][11]?.value == 'percentage' || report.fields[0][10]?.value == 'percentage')"></app-percentage-without-trans-rep>
                <app-one-year-with-parts-and-total-rep [report]="report"
                    *ngIf="report.reportType == 'TablesReport' && report.fields.length > 0 && (report.fields[0][10]?.value == 7 || report.fields[0][11]?.value == 7) && (report.fields[0][12]?.value == 'withTotal' || report.fields[0][11]?.value == 'withTotal')"></app-one-year-with-parts-and-total-rep>

                <app-no-rep-data [report]="report" *ngIf="report.fields.length == 0"></app-no-rep-data>
                <table class="table table-borderless scrollable-table"
                    *ngIf="report.reportType == 'FormContent' && report.fields.length > 0">
                    <thead>
                        <tr class="t-header">
                            <th style="text-align: center;" scope="col">#</th>
                            <th style="text-align: center;" scope="col">
                                المؤشر</th>
                            <th style="text-align: center;" scope="col" *ngIf="report.seconedTable == 'ActivitiesRep'">
                                كود النشاط </th>
                            <th style="text-align: center;" scope="col" *ngIf="report.seconedTable == 'ActivitiesRep'">
                                النشاط</th>
                            <th style="text-align: center;" scope="col" *ngIf="report.seconedTable == 'CompaniesRep'">
                                اسم الشركة</th>
                            <th style="text-align: center;" scope="col" *ngIf="report.seconedTable == 'CompaniesRep'">
                                كود النشاط</th>
                            <th style="text-align: center;" scope="col" *ngIf="report.seconedTable == 'SectorsRep'">
                                كود القطاع </th>
                            <th style="text-align: center;" scope="col" *ngIf="report.seconedTable == 'SectorsRep'">
                                القطاع</th>
                            <ng-container *ngFor="let detail of report.reportDetails[1].Fields">
                                <th style="text-align: center;" scope="col"
                                    *ngIf="report.reportDetails[1].EnTableName == 'Years' && report.reportDetails[1].Fields.length > 1">
                                    {{detail.name}}</th>
                            </ng-container>
                        </tr>
                    </thead>
                    <tbody *ngIf="report.seconedTable == 'ActivitiesRep' || report.seconedTable == 'SectorsRep'">
                        <tr *ngFor="let list of transActivityFields(report.fields,report); let i = index">
                            <td style="text-align: center;" scope="col">{{i+1}}</td>
                            <td style="text-align: center;">{{ list.codeArName }}</td>
                            <td>{{ list.activityCode}}</td> <!-- كود النشاط -->
                            <td>{{ list.activityArName }}</td>
                            <!-- النشاط باللغة العربية -->
                            <td style="text-align: center;" *ngFor="let item of list.years">
                                {{ item.value }}
                            </td>
                        </tr>
                    </tbody>
                    <tbody *ngIf="report.seconedTable == 'CompaniesRep'">
                        <tr *ngFor="let list of transActivityFields(report.fields,report); let i = index">
                            <td style="text-align: center;" scope="col">{{i+1}}</td>
                            <td style="text-align: center;">{{ list.codeArName }}</td>
                            <td>{{ list.activityArName}}</td> <!-- كود النشاط -->
                            <td>{{ list.activityCode }}</td>
                            <!-- النشاط باللغة العربية -->
                            <td style="text-align: center;" *ngFor="let item of list.years">
                                {{ item.value }}
                            </td>
                        </tr>
                    </tbody>
                    <tbody *ngIf="report.seconedTable == 'Years' && report.reportType == 'FormContent'">
                        <tr *ngFor="let list of transformFields(report.fields,report); let i = index">
                            <td style="text-align: center;" scope="col">{{ i + 1 }}</td>
                            <td style="text-align: center;">{{ list.codeArName }}</td>
                            <td style="text-align: center;" *ngFor="let item of list.years">
                                {{ item.value }}
                            </td>
                        </tr>
                    </tbody>
                    <tfoot *ngIf="report.seconedTable == 'Years' && report.reportType == 'FormContent'">
                        <tr>
                            <td colspan="2" style="text-align: center; font-weight: bold;background-color: #56bfb533;">الإجمالي</td>

                            <td style="text-align: center;background-color: #56bfb533;"
                                *ngFor="let total of getColumnTotals(report.fields,report)">
                                {{ total.total }}
                            </td>
                        </tr>
                    </tfoot>
                    <tfoot *ngIf="report.seconedTable != 'Years'">
                        <tr>
                            <td colspan="4" style="text-align: center;background-color: #56bfb533;"
                                *ngIf="report.seconedTable != 'Years' && report.seconedTable != 'CompaniesRep'">الإجمالي
                            </td>
                            <td colspan="2" style="text-align: center;background-color: #56bfb533;" *ngIf="report.seconedTable == 'Years' ">الإجمالي
                            </td>
                            <td colspan="4" style="text-align: center;background-color: #56bfb533;" *ngIf="report.seconedTable == 'CompaniesRep'">
                                الإجمالي
                            </td>
                            <td style="text-align: center;background-color: #56bfb533;" *ngFor="let total of getColumnTotals(report.fields,report)">{{ total.total }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

        </div>
    </div>

</div>
<!--start add report modal -->
<div class="modal company-modal fade" id="addReportDetails" tabindex="-1" aria-labelledby="add" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm" style="min-width: 880px;">
        <div class="modal-content">
            <div class="modal-header pb-0">
                <h5 class="modal-title" id="add">إنشاء محتوى التقرير</h5>
            </div>
            <form>
                <div class="modal-body">
                    <div class="row">
                        <!-- First three fields on the same row -->
                        <div class="col-sm-8 mb-3 label-with-icon">
                            <input style="width: 100%;" class="form-control input-modal" [(ngModel)]="report.part"
                                type="text" name="reportPart" required #reportPartInput="ngModel"
                                (ngModelChange)="onReportPartChange($event)">
                            <label style="top: 14px;">اسم محتوى التقرير</label>
                        </div>
                        <span *ngIf="isReportNameError" style="color: red;">{{errorMessage}}</span>
                        <div class="col-sm-4 mb-3">
                            <select [(ngModel)]="tableType" name="tableType" (change)="onTableSelect()"
                                class="form-select add-report-select" style="width: 100%;">
                                <option selected [ngValue]="0" disabled>اختر الجدول</option>
                                <option [ngValue]="1">شركات</option>
                                <option [ngValue]="2">استمارات</option>
                                <option [ngValue]="3">باحثين</option>
                                <option [ngValue]="4">محتوى الاستمارة</option>
                                <option [ngValue]="5">تقرير الجداول</option>
                            </select>
                            <span *ngIf="isTableError" style="color: red;">{{errorMessage}}</span>
                        </div>
                    </div>
                    <div class="row" *ngIf="tableType != 5">
                        <div class="col-sm-4 mb-3">
                            <select (ngModelChange)="onReportYearChange()" [(ngModel)]="reportYearFrom"
                                name="reportYearFrom" class="form-select add-report-select" style="width: 100%;">
                                <option selected [ngValue]="0" disabled>اختر السنه</option>
                                <option *ngFor="let year of years" [ngValue]="year.arName">{{year.arName}}</option>
                            </select>
                            <label [ngStyle]="{ 'top': isReportNameError ? '90px' : '70px' }">السنه من</label>
                            <!-- Error message if reportYearFrom is not selected -->
                            <span *ngIf="isYearError" style="color: red;">{{errorMessage}}</span>
                        </div>
                        <div class="col-sm-4 mb-3">
                            <select [(ngModel)]="reportYearTo" name="reportYearTo" class="form-select add-report-select"
                                style="width: 100%;">
                                <option selected [ngValue]="0" disabled>اختر السنه</option>
                                <option *ngFor="let year of years" [ngValue]="year.arName">{{year.arName}}</option>
                            </select>
                            <label [ngStyle]="{ 'top': isReportNameError ? '90px' : '70px', 'right': '19rem' }">السنه
                                الى</label>
                        </div>

                    </div>
                    <!-- Scrollable Cards Section -->
                    <div class="d-flex overflow-auto" *ngIf="tables && tables.length > 0"
                        style="gap: 15px; white-space: nowrap; padding: 15px;">
                        <!-- Card 1 -->
                        <ng-container *ngFor="let table of tables;let i= index">
                            <div class="card" *ngIf="table.enTableName != 'Years'"
                                style="min-width: 490px; border: 1px solid #ccc;max-height: 280px;min-height: 280px;">
                                <div class="modal-header pb-0">
                                    <label class="modal-title" id="add">{{table.arTableName}}</label>
                                </div>
                                <div class="card-body" *ngIf="table.enTableName != 'FormContent' && table.enTableName != 'TablesReport' && 
                                table.enTableName != 'ActivitiesRep' && table.enTableName != 'CompaniesRep' && table.enTableName != 'SectorsRep'
                                && table.enTableName != 'Countries' && table.enTableName != 'Years'">
                                    <div class="d-flex align-items-center">
                                        <!-- Checkbox aligned on the left -->
                                        <div class="d-flex align-items-center mb-3">
                                            <!-- Checkbox with bottom margin -->
                                            <input type="checkbox" class="form-check-input me-2"
                                                id="selectAllFieldsCheckbox" style="margin-bottom: 15px;"
                                                [(ngModel)]="table.selectAllFields" name="selectAllFields" />
                                            <!-- Label linked to the checkbox, with top margin for alignment -->
                                            <label for="selectAllFieldsCheckbox"
                                                style="margin-top: 5px; position: static;">اختر جميع الحقول</label>
                                            <button class="icon" *ngIf="i!=0" (click)="removeTable(table)"
                                                style="border: none; background-color: transparent">
                                                <img src="../../../../assets/images/trash-can-outline.png" alt="" />
                                            </button>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <!-- Select input aligned next to the checkbox with more space -->
                                        <div class="form-group col-sm-4 mb-2" *ngIf="table.enTableName == 'Cover'"
                                            style="margin-left:5px;">
                                            <select class="form-select add-report-select" style="width: 100%;"
                                                (change)="onFormTypeChange($event)">
                                                <option value="1">استمارة سنوية</option>
                                                <option value="2">استمارة ربعية</option>
                                            </select>
                                            <label for="inputField">نوع الإستمارة</label>
                                        </div>
                                        <div class="form-group col-sm-6 mb-2">
                                            <select class="form-select add-report-select"
                                                (change)="onFieldSelect($event,'', table)" style="width: 100%;">
                                                <option selected value="0" disabled>اختر الحقل</option>
                                                <ng-container *ngIf="table.enTableName == 'Companies'">
                                                    <ng-container *ngFor="let field of companyFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Forms'">
                                                    <ng-container *ngFor="let field of formFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Researcher'">
                                                    <ng-container *ngFor="let field of researcherFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Sectors'">
                                                    <ng-container *ngFor="let field of sectorFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Activities'">
                                                    <ng-container *ngFor="let field of activitiesFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'SubActivities'">
                                                    <ng-container *ngFor="let field of subActivitiesFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Governorates'">
                                                    <ng-container *ngFor="let field of governoratesFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Wilayats'">
                                                    <ng-container *ngFor="let field of wilayatFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Tables'">
                                                    <ng-container *ngFor="let field of tableFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'GeneralData'">
                                                    <ng-container *ngFor="let field of generalDataFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Certification'">
                                                    <ng-container *ngFor="let field of certificationFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                                <ng-container *ngIf="table.enTableName == 'Cover'">
                                                    <ng-container *ngFor="let field of currentFields">
                                                        <option [value]="field.name">{{
                                                            field.arName }}</option>
                                                    </ng-container>
                                                </ng-container>
                                            </select>
                                            <label for="inputField">الفلتر</label>
                                        </div>
                                        <p style="margin-right: 10px;font-size: 15px;margin-top: 10px;">اختر الفلتر</p>
                                    </div>
                                    <div class="field-container"
                                        style="padding-left: 5px; padding-top: 5px; max-height: 145px;">
                                        <div class="field-item" *ngFor="let field of table.fields; let i = index">
                                            <!-- Bind field properties to the input element -->
                                            <span style="text-align: left;margin-left: 60px;"
                                                class="field-text col-2">{{field.arName}}</span>
                                            <select style="width: 120px;margin-left: 7px;"
                                                class="form-select add-report-select" [(ngModel)]="field.filter"
                                                [ngModelOptions]="{standalone: true}">
                                                <option value="" disabled>اختر الفلتر</option>
                                                <ng-container
                                                    *ngIf="field.dataType !== 'String' && field.dataType != 'bool'">
                                                    <option *ngFor="let filter of numberFilterItems"
                                                        [ngValue]="filter.id">
                                                        {{filter.arName}}
                                                    </option>
                                                </ng-container>
                                                <ng-container
                                                    *ngIf="field.dataType === 'String' || field.dataType === 'bool'">
                                                    <option *ngFor="let filter of stringFilterItems"
                                                        [ngValue]="filter.id">
                                                        {{filter.arName}}
                                                    </option>
                                                </ng-container>
                                            </select>
                                            <select style="width: 177px;margin-left: 10px;"
                                                *ngIf="field.dataType === 'bool'" class="form-select add-report-select"
                                                [(ngModel)]="field.value" [ngModelOptions]="{standalone: true}">
                                                <option value="" disabled>اختر --</option>
                                                <option value="1">نعم</option>
                                                <option value="0">لا</option>
                                            </select>
                                            <input *ngIf="field.dataType != 'bool'" type="text" class="field-input"
                                                [(ngModel)]="field.value" name="field-{{ i }}">
                                            <button class="icon" (click)="removeFilterRow(table,field)"
                                                style="border: none; background-color: transparent">
                                                <img src="../../../../assets/images/trash-can-outline.png" alt="" />
                                            </button>

                                        </div>
                                    </div>
                                </div>
                                <div class="card-body" *ngIf="table.enTableName == 'FormContent' || table.enTableName == 'TablesReport'  
                                || table.enTableName == 'ActivitiesRep' || table.enTableName == 'SectorsRep' 
                                || table.enTableName == 'CompaniesRep' || table.enTableName == 'Countries'">
                                    <button *ngIf="i!=0" class="icon" (click)="removeTable(table)"
                                        style="border: none; background-color: transparent">
                                        <img src="../../../../assets/images/trash-can-outline.png" alt="" />
                                    </button>
                                    <div style="width: 100%; margin-top: 15px !important"
                                        class="form-group col-sm-6 mb-2">
                                        <div class="dropdown" [class.show]="isDropdownOpen"
                                            *ngIf="table.enTableName == 'FormContent'">
                                            <div style="height: 85px !important;">
                                                <input type="text" id="searchableDropdown"
                                                    class="form-control input-modal" placeholder="Search..."
                                                    [(ngModel)]="searchFormContentTerm" name="searchFormContentTerm"
                                                    (click)="toggleFormContentDropdown()" (input)="filterSubCodes()" />
                                                <ul class="dropdown-menu" [class.show]="isFormContentDropdownOpen"
                                                    style="padding: 0 9px; max-height: 120px;width: 100%;text-align: right;">
                                                    <li class="dropdown-item" *ngFor="let code of filteredCodes"
                                                        (click)="selectCode($event, tables[0],code)">
                                                        {{code.arName}}
                                                    </li>
                                                </ul>
                                                <div class="field-container"
                                                    style="padding-left: 5px; padding-top: 5px; max-height: 190px;">
                                                    <div class="field-item"
                                                        *ngFor="let content of tables[0].fields; let i = index">
                                                        <!-- Bind field properties to the input element -->
                                                        <span style="text-align: right;min-width: 384px;"
                                                            class="field-text col-2">{{content.name}}</span>
                                                        <button class="icon" (click)="removeFilterRow(table,content)"
                                                            style="border: none; background-color: transparent">
                                                            <img src="../../../../assets/images/trash-can-outline.png"
                                                                alt="" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <label for="inputField">اختر المؤشر</label>
                                            </div>
                                            <!-- <div>
                                                <input type="text" id="searchableDropdown"
                                                    class="form-control input-modal" placeholder="Search..."
                                                    [(ngModel)]="searchYearTerm" name="searchYearTerm"
                                                    (click)="toggleYearsDropdown()" (input)="filterYearsRep()" />
                                                <ul class="dropdown-menu" [class.show]="isYearsDropdownOpen"
                                                    style="padding: 0 9px; max-height: 100px;width: 100%;text-align: right;">
                                                    <li class="dropdown-item" *ngFor="let year of years"
                                                        (click)="selectYearRep($event, tables[1],year)">
                                                        {{year.arName}}
                                                    </li>
                                                </ul>
                                                <label style="top: 85px;" for="inputField">اختر السنة</label>
                                            </div> -->
                                        </div>
                                        <div class="dropdown" [class.show]="isDropdownOpen"
                                            *ngIf="table.enTableName == 'TablesReport'">
                                            <div style="height: 85px !important;">
                                                <input type="text" id="searchableDropdown"
                                                    class="form-control input-modal" placeholder="Search..."
                                                    [(ngModel)]="searchTerm" name="searchTerm"
                                                    (click)="toggleDropdown()" (input)="filterTablesRep()" />
                                                <ul class="dropdown-menu" [class.show]="isDropdownOpen" style="padding: 0 9px; max-height: 120px;
                                      width: 100%;
                                      text-align: right;">
                                                    <li class="dropdown-item" *ngFor="let tableRep of filteredTables"
                                                        (click)="selectTable($event, tables[0],tableRep)">
                                                        {{tableRep.arName}}
                                                    </li>
                                                </ul>
                                                <label for="inputField">اختر الجدول</label>
                                            </div>
                                            <div>
                                                <input type="text" id="searchableDropdown"
                                                    class="form-control input-modal" placeholder="Search..."
                                                    [(ngModel)]="searchYearTerm" name="searchYearTerm"
                                                    (click)="toggleYearsDropdown()" (input)="filterYearsRep()" />
                                                <ul class="dropdown-menu" [class.show]="isYearsDropdownOpen" style="padding: 0 9px; max-height: 100px;
                                      width: 100%;
                                      text-align: right;">
                                                    <li class="dropdown-item" *ngFor="let year of years"
                                                        (click)="selectYearRep($event, tables[1],year)">
                                                        {{year.arName}}
                                                    </li>
                                                </ul>
                                                <label style="top: 85px;" for="inputField">اختر السنة</label>
                                            </div>
                                        </div>
                                        <div class="dropdown" [class.show]="isDropdownOpen"
                                            *ngIf="table.enTableName == 'ActivitiesRep'">
                                            <input type="text" id="searchableDropdown" class="form-control input-modal"
                                                placeholder="Search..." [(ngModel)]="searchActivityTerm"
                                                name="searchActivityTerm" (click)="toggleActivityDropdown()"
                                                (input)="filterActivitiesRep()" />
                                            <ul class="dropdown-menu" [class.show]="isActivityDropdownOpen" style="padding: 0 9px; max-height: 120px;
                                      width: 100%;
                                      text-align: right;">
                                                <li class="dropdown-item" *ngFor="let activity of filteredActivities"
                                                    (click)="selectActivityRep($event, tables[2],activity)">
                                                    {{activity.arName}}
                                                </li>
                                            </ul>
                                            <label for="inputField">اختر النشاط</label>
                                        </div>
                                        <div class="dropdown" [class.show]="isDropdownOpen"
                                            *ngIf="table.enTableName == 'Countries'">
                                            <input type="text" id="searchableDropdown" class="form-control input-modal"
                                                placeholder="Search..." [(ngModel)]="searchCountryTerm"
                                                name="searchCountryTerm" (click)="toggleCountryDropdown()"
                                                (input)="filterCountriesRep()" />
                                            <ul class="dropdown-menu" [class.show]="isCountryDropdownOpen" style="padding: 0 9px; max-height: 120px;
                                      width: 100%;
                                      text-align: right;">
                                                <li class="dropdown-item" *ngFor="let country of filteredCountries"
                                                    (click)="selectCountryRep($event, tables[2],country)">
                                                    {{country.arName}}
                                                </li>
                                            </ul>
                                            <label for="inputField">اختر الدولة</label>
                                        </div>
                                        <div class="dropdown" [class.show]="isDropdownOpen"
                                            *ngIf="table.enTableName == 'SectorsRep'">
                                            <input type="text" id="searchableDropdown" class="form-control input-modal"
                                                placeholder="Search..." [(ngModel)]="searchSectorTerm"
                                                name="searchSectorTerm" (click)="toggleSectorDropdown()"
                                                (input)="filterSectorRep()" />
                                            <ul class="dropdown-menu" [class.show]="isSectorDropdownOpen" style="padding: 0 9px; max-height: 120px;
                                      width: 100%;
                                      text-align: right;">
                                                <li class="dropdown-item" *ngFor="let sector of filteredSectors"
                                                    (click)="selectSectorRep($event, tables[2],sector)">
                                                    {{sector.arName}}
                                                </li>
                                            </ul>
                                            <label for="inputField">اختر القطاع</label>
                                        </div>
                                        <div class="dropdown" [class.show]="isDropdownOpen"
                                            *ngIf="table.enTableName == 'CompaniesRep'">
                                            <input type="text" id="searchableDropdown" class="form-control input-modal"
                                                placeholder="Search..." [(ngModel)]="searchCompanyTerm"
                                                name="searchCompanyTerm" (click)="toggleCompanyDropdown()"
                                                (input)="filterCompaniesRep()" />
                                            <ul class="dropdown-menu" [class.show]="isCompanyDropdownOpen" style="padding: 0 9px; max-height: 120px;
                                      width: 100%;
                                      text-align: right;">
                                                <li class="dropdown-item" *ngFor="let company of filteredCompanies"
                                                    (click)="selectCompanyRep($event, tables[2],company)">
                                                    {{company.arName}}
                                                </li>
                                            </ul>
                                            <label for="inputField">اختر الشركة</label>
                                        </div>
                                    </div>
                                    <div class="field-container"
                                        *ngIf="tables.length == 3 && table.enTableName !='TablesReport' && table.enTableName !='FormContent'"
                                        style="padding-left: 5px; padding-top: 5px; max-height: 190px;">
                                        <div class="field-item" *ngFor="let content of tables[2].fields; let i = index">
                                            <!-- Bind field properties to the input element -->
                                            <span style="text-align: right;min-width: 384px;"
                                                class="field-text col-2">{{content.name}}</span>
                                            <button class="icon" (click)="removeFilterRow(table,content)"
                                                style="border: none; background-color: transparent">
                                                <img src="../../../../assets/images/trash-can-outline.png" alt="" />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>

                        <!-- Add Button -->
                        <button (click)="openModal()"
                            style="background-color: #00af9d; border-radius: 5px; float: left; height: 30px;">
                            <i style="color: white;" class="fa fa-plus" aria-hidden="true"></i>
                        </button>

                    </div>
                    <span *ngIf="isContenterror" style="color: red;">{{errorMessage}}</span>

                    <!-- Continue with remaining fields -->
                    <!-- <h4 class="mb-3">نوع التقرير</h4> -->
                    <!-- <div class="form-check ps-0 d-flex radio-form me-2 col-6">
                        <input class="form-check-input" checked type="radio" id="haveChart" name="chartOptions"
                            [value]="true" [(ngModel)]="report.withChart">
                        <label style="width: 17rem;margin-top: 22px;font-size: 17px !important;"
                            class="form-check-label" for="haveChart">يشمل رسم بيانى</label>

                        <input class="form-check-input" type="radio" id="notHaveChart" name="chartOptions"
                            [value]="false" [(ngModel)]="report.withChart">
                        <label style="width: 35rem;margin-top: 24px;font-size: 17px !important;"
                            class="form-check-label" for="notHaveChart">لا يشمل رسم بيانى</label>
                    </div> -->

                </div>

                <div class="modal-footer pt-0" style="border-top: none;">
                    <button type="button" id="close" class="btn btn-cancel" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn" (click)="saveReport()">حفظ</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--end add report modal -->

<!--start add company modal -->
<div class="modal company-modal fade" id="chooseTable" tabindex="-1" aria-labelledby="add" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm" style="min-width: 880px;">
        <div class="modal-content" style="width: 370px; margin: 0 auto;">
            <div class="modal-header pb-0">
                <h5 class="modal-title" id="add">اختيار من جدول فرعي</h5>
            </div>
            <form>
                <div class="modal-body">
                    <select class="form-select add-report-select" style="width: 100%;" [(ngModel)]="selectedTable"
                        [ngModelOptions]="{standalone: true}">
                        <option value="" disabled>اختر الجدول الفرعي</option>
                        <ng-container *ngIf="tableType==1">
                            <option *ngFor="let table of companyTables" [ngValue]="table">{{table.arName}}</option>
                        </ng-container>
                        <ng-container *ngIf="tableType==2">
                            <option *ngFor="let table of formTables" [ngValue]="table">{{table.arName}}</option>
                        </ng-container>
                        <ng-container *ngIf="tableType==3">
                            <option *ngFor="let table of researcherTables" [ngValue]="table">{{table.arName}}</option>
                        </ng-container>
                        <ng-container *ngIf="tableType==4">
                            <option *ngFor="let table of tableRepTables" [ngValue]="table">{{table.arName}}</option>
                        </ng-container>
                        <ng-container *ngIf="tableType==5">
                            <option *ngFor="let table of tableRepTables" [ngValue]="table">{{table.arName}}</option>
                        </ng-container>
                    </select>

                </div>
                <div class="modal-footer pt-0" style="border-top: none;">
                    <button type="button" class="btn btn-cancel" (click)="closeModal()">إلغاء</button>
                    <button type="button" class="btn btn-save" (click)="appendTable()">حفظ</button>
                </div>
            </form>
        </div>
    </div>
</div>