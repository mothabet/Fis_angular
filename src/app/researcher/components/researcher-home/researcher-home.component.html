<app-loader *ngIf="showLoader"></app-loader>
<!-- main content -->
<div class="main-content p-4 main card" style="flex: 1">
  <app-top-screen [title]="'الباحثين'"></app-top-screen>

  <!-- start content -->
  <div class="content companies researcher">
    <div class="header d-flex mb-0">
      <div class="title">قائمة الباحثين</div>
      <div class="btns d-flex">
        <div class="search" id="research-search">
          <input
            class="form-control"
            type="text"
            name="search"
            placeholder="البحث"
          />
          <i class="fa fa-search icon" id="search-icon" aria-hidden="true"></i>
        </div>
        <div class="d-flex gap-1 flex-grow-1" id="research-btns">
          <button
            type="button"
            class="btn btn-add"
            data-bs-toggle="modal"
            data-bs-target="#addResearcher"
          >
            <img
              src="../../../../assets/images/briefcase-plus-outli.png"
              alt=""
              id="addResearcherBtn"
            />
            إضافة باحث
          </button>
          <button type="button" class="btn btn-download">
            <img src="../../../../assets/images/list-box-outline.png" alt="" />
            تنزيل PDF
          </button>
        </div>
      </div>
    </div>

    <div class="table-responsive company-table research-table">
      <table class="table table-borderless">
        <thead>
          <tr class="t-header">
            <th scope="col">رقم</th>
            <th class="text-center" scope="col">اسم المستخدم</th>
            <th class="text-center" scope="col">البريد الإلكتروني</th>
            <th class="text-center" scope="col">الحالة</th>
            <th class="text-center" scope="col"></th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let item of researchers; let i = index">
            <td>
              <label for="Name1">{{ i + 1 }}</label>
            </td>
            <td class="text-center">{{ item.fullName }}</td>
            <td class="text-center">{{ item.email }}</td>
            <td class="text-center active">
              <ng-container *ngIf="item.status; else inactive">
                نشط
              </ng-container>
              <ng-template #inactive> غير نشط </ng-template>
            </td>
            <td class="text-center td-actions">
              <a
                class="icon"
                data-bs-toggle="modal"
                data-bs-target="#companyLink"
              >
                <img src="../../../../assets/images/link.png" alt="" />
              </a>
              <a routerLink="/Researcher-Details" class="icon">
                <img src="../../../../assets/images/eye-outline.png" alt="" />
              </a>
              <button class="icon" (click)="showAlert(item.id)">
                <img
                  src="../../../../assets/images/trash-can-outline.png"
                  alt=""
                />
              </button>
              <button class="icon" (click)="editResearcher(item.id)">
                <img
                  src="../../../../assets/images/pencil-outline.png"
                  alt=""
                />
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot *ngIf="noData">
          <tr>
            <th colspan="7">
              <div class="alert alert-warning">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <br />
                <span> لا يوجد بيانات </span>
              </div>
            </th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <!-- end content -->
</div>

<!--start modal -->

<!--start add researcher modal -->
<div
  class="modal company-modal fade"
  id="addResearcher"
  tabindex="-1"
  aria-labelledby="add"
  aria-hidden="true"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header pb-0">
        <h5 class="modal-title" id="add" *ngIf="add">إضافة باحث</h5>
        <h5 class="modal-title" id="edit" *ngIf="!add">تعديل الباحث</h5>
      </div>
      <form [formGroup]="researcherForm">
        <div class="modal-body pb-1">
          <div class="row">
            <div class="col-sm-6 mb-2">
              <input
                class="form-control input-modal input-disabled"
                type="text"
                placeholder="اسم المستخدم"
                [(ngModel)]="researcherForm.value.userName"
                formControlName="userName"
                name="username"
              />
            </div>
            <div class="col-sm-6 mb-2" id="researcherPass">
              <input
                class="form-control input-modal input-disabled"
                type="text"
                placeholder="كلمة المرور"
                [(ngModel)]="researcherForm.value.password"
                formControlName="password"
                name="password"
              />
              <button
                type="button"
                id="reload"
                (click)="generateRandomCredentials()"
                *ngIf="add"
              >
                <img src="../../../../assets/images/refresh.png" alt="" />
              </button>
            </div>
            <div class="col-sm-6 mb-2">
              <input
                class="form-control input-modal"
                type="text"
                [(ngModel)]="researcherForm.value.fullName"
                placeholder="الاسم بالكامل"
                formControlName="fullName"
              />
              <div
                *ngIf="
                  researcherForm.controls['fullName'].invalid &&
                  (researcherForm.controls['fullName'].dirty ||
                    researcherForm.controls['fullName'].touched)
                "
              >
                <small
                  *ngIf="researcherForm.controls['fullName'].errors?.['required']"
                  class="text-danger"
                >
                  يجب ادخال الاسم بالكامل.
                </small>
              </div>
            </div>
            <div class="col-sm-6 mb-2">
              <input
                class="form-control input-modal"
                type="text"
                placeholder="English Full Name"
                formControlName="enfullName"
              />
              <div
                *ngIf="
                  researcherForm.controls['enfullName'].invalid &&
                  (researcherForm.controls['enfullName'].dirty ||
                    researcherForm.controls['enfullName'].touched)
                "
              >
                <small
                  *ngIf="researcherForm.controls['enfullName'].errors?.['required']"
                  class="text-danger"
                >
                  English Full Name is required.
                </small>
              </div>
            </div>

            <div class="col-sm-6 mb-2">
              <select
                class="form-control"
                style="width: 100%"
                formControlName="status"
                [(ngModel)]="researcherForm.value.status"
              >
                <option value="" disabled selected>الحاله</option>
                <option [ngValue]="true">نشط</option>
                <option [ngValue]="false">غير نشط</option>
              </select>
              <div
                *ngIf="
                  researcherForm.controls['status'].invalid &&
                  (researcherForm.controls['status'].dirty ||
                    researcherForm.controls['status'].touched)
                "
              >
                <small
                  *ngIf="researcherForm.controls['status'].errors?.['required']"
                  class="text-danger"
                >
                  Status is required.
                </small>
              </div>
            </div>

            <div class="col-10 col-sm-4 mb-2">
              <input
                class="form-control input-modal"
                type="text"
                placeholder="رقم الهاتف"
                formControlName="phone"
                maxlength="8"
                minlength="8"
                pattern="[0-9]*"
                (input)="onlyNumber($event)"
              />
              <div
                *ngIf="
                  researcherForm.controls['phone'].touched &&
                  researcherForm.controls['phone'].dirty &&
                  researcherForm.controls['phone'].value !== '' &&
                  researcherForm.controls['phone'].invalid
                "
              >
                <small
                  *ngIf="researcherForm.controls['phone'].errors?.['pattern']"
                  class="text-danger"
                >
                  يجب ادخال ارقام فقط
                </small>
                <small
                  *ngIf="researcherForm.controls['phone'].errors?.['minlength']"
                  class="text-danger"
                >
                  يجب ان يكون رقم الهاتف 8 ارقام.
                </small>
              </div>
            </div>
            <div class="col-2 mb-2">
              <input
                class="form-control input-modal input-disabled"
                type="text"
                placeholder="كود الهاتف"
                value="{{ phoneCode }}"
              />
            </div>
            <div class="col-sm-6 mb-2">
              <input
                class="form-control input-modal"
                type="email"
                placeholder="عنوان البريد الإلكتروني"
                [(ngModel)]="researcherForm.value.email"
                formControlName="email"
              />
              <div
                *ngIf="
                  researcherForm.controls['email'].invalid &&
                  (researcherForm.controls['email'].dirty ||
                    researcherForm.controls['email'].touched)
                "
              >
                <small
                  *ngIf="researcherForm.controls['email'].errors?.['required']"
                  class="text-danger"
                >
                  يجب ادخال البريد الاليكتروني.
                </small>
                <small
                  *ngIf="researcherForm.controls['email'].errors?.['email']"
                  class="text-danger"
                >
                  البريد الاليكتروني غير صحيح.
                </small>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer pt-0">
          <button
            type="button"
            class="btn btn-cancel"
            data-bs-dismiss="modal"
            id="btnCancel"
            (click)="reset()"
          >
            إلغاء
          </button>
          <button type="button" class="btn btn-reset" (click)="resetForm()">
            إعادة ملء
          </button>
          <button
            type="button"
            class="btn btn-save"
            (click)="saveResearcher()"
            *ngIf="add"
            [disabled]="!researcherForm.valid"
          >
            حفظ
          </button>
          <button
            type="button"
            class="btn btn-save"
            (click)="updateResearcher()"
            *ngIf="!add"
            [disabled]="!researcherForm.valid"
          >
            تعديل
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!--end add researcher modal -->

<!--start linked company modal -->
<div
  class="modal company-modal fade"
  id="companyLink"
  tabindex="-1"
  aria-labelledby="add"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div
        class="modal-title pt-3 modal-header d-flex justify-content-between pt-0"
      >
        <h5>ربط بالشركة</h5>
        <div class="search">
          <input
            class="form-control"
            type="text"
            name="search"
            placeholder="البحث"
          />
          <i class="fa fa-search icon" id="search-icon" aria-hidden="true"></i>
        </div>
      </div>
      <div class="table-responsive company-modal-table mx-2">
        <table class="table table-borderless">
          <thead>
            <tr class="t-header">
              <th scope="col">اسم الشركة</th>
              <th class="text-center" scope="col">رقم السجل التجاري</th>
              <th class="text-center" scope="col">رقم الشركة</th>
              <th class="text-center" scope="col">رمز النشاط</th>
              <th class="text-center" scope="col">النشاط</th>
              <th class="text-center" scope="col">عنوان الشركة</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <input type="checkbox" name="companyName1" id="companyName1" />
                <label for="companyName1">شركة الابداع</label>
              </td>
              <td class="text-center">021124444</td>
              <td class="text-center">86431</td>
              <td class="text-center">184510</td>
              <td class="text-center">الترفيه</td>
              <td class="text-center">الخوير، مسقط</td>
            </tr>
            <tr>
              <td>
                <input type="checkbox" name="companyName2" id="companyName2" />
                <label for="companyName2">شركة الابداع</label>
              </td>
              <td class="text-center">021124444</td>
              <td class="text-center">86431</td>
              <td class="text-center">184510</td>
              <td class="text-center">الترفيه</td>
              <td class="text-center">الخوير، مسقط</td>
            </tr>
            <tr class="last">
              <td>
                <input type="checkbox" name="companyName3" id="companyName3" />
                <label for="companyName3">شركة الابداع</label>
              </td>
              <td class="text-center">021124444</td>
              <td class="text-center">86431</td>
              <td class="text-center">184510</td>
              <td class="text-center">الترفيه</td>
              <td class="text-center">الخوير، مسقط</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
          إلغاء
        </button>
        <button type="button" class="btn btn-add">حفظ</button>
      </div>
    </div>
  </div>
</div>
<!--end linked company modal -->

<!--end modal -->
